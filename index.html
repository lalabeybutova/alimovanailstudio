<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Alimova Nail Studio</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: url('0c662273-be1f-43ef-8657-12441dd1edb9.png') no-repeat center center fixed;
      background-size: cover;
      color: #333;
    }
    .overlay {
      background: rgba(255, 255, 255, 0.88);
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      overflow-y: auto;
    }
    header {
      background: linear-gradient(90deg, #fce7f3, #e0e7ff, #fef3c7);
      padding: 20px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      color: #6b21a8;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    #login, #changePwBox {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      gap: 12px;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid #ccc;
      width: 250px;
    }
    button {
      background: linear-gradient(90deg, #ec4899, #8b5cf6);
      color: #fff;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      opacity: 0.9;
    }
    #app {
      display: none;
      padding: 20px;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 10px;
      text-align: center;
    }
    .delete-btn {
      cursor: pointer;
      color: red;
      font-weight: bold;
    }
    .search-box {
      margin: 10px 0;
      width: 100%;
      max-width: 300px;
    }
    @media (max-width: 600px) {
      input, button { width: 90%; }
      .search-box { width: 90%; }
    }
  </style>
</head>
<body>
<div class="overlay">
  <header>üíÖ Alimova Nail Studio</header>

  <!-- –í—Ö–æ–¥ -->
  <div id="login">
    <h2>üîí –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</h2>
    <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" />
    <button onclick="checkPassword()">–í–æ–π—Ç–∏</button>
    <p id="error" style="color:red; display:none;">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å</p>
    <button onclick="showChangePw()">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
  </div>

  <!-- –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è -->
  <div id="changePwBox" style="display:none;">
    <h2>üîë –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h2>
    <input type="password" id="oldPw" placeholder="–°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å" />
    <input type="password" id="newPw" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" />
    <input type="password" id="confirmPw" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" />
    <button onclick="changePassword()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button onclick="backToLogin()">–û—Ç–º–µ–Ω–∞</button>
    <p id="pwError" style="color:red; display:none;">–û—à–∏–±–∫–∞ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è</p>
  </div>

  <!-- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
  <div id="app">
    <div class="card">
      <h2>üìÖ –ó–∞–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç–∞</h2>
      <input type="text" id="name" placeholder="–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞" />
      <input type="tel" id="phone" maxlength="10" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (10 —Ü–∏—Ñ—Ä)" />
      <input type="date" id="date" />
      <input type="time" id="time" />
      <input type="number" id="price" placeholder="–¶–µ–Ω–∞ (NOK)" />
      <button onclick="addBooking()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
    </div>

    <div class="card">
      <h2>üìã –í—Å–µ –∑–∞–ø–∏—Å–∏</h2>
      <input type="text" class="search-box" id="searchAll" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏..." oninput="renderBookings()" />
      <table id="bookingTable">
        <tr><th>–ò–º—è</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>–î–∞—Ç–∞</th><th>–í—Ä–µ–º—è</th><th>–¶–µ–Ω–∞</th></tr>
      </table>
    </div>

    <div class="card">
      <h2>üîî –ó–∞–ø–∏—Å–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h2>
      <input type="text" class="search-box" id="searchToday" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏..." oninput="renderToday()" />
      <table id="todayTable">
        <tr><th>–ò–º—è</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>–í—Ä–µ–º—è</th><th>–î–µ–π—Å—Ç–≤–∏–µ</th></tr>
      </table>
    </div>

    <div class="card">
      <h2>üìä –î–æ—Ö–æ–¥</h2>
      <p id="dailyRevenue">–°–µ–≥–æ–¥–Ω—è: 0 NOK</p>
      <p id="monthlyRevenue">–≠—Ç–æ—Ç –º–µ—Å—è—Ü: 0 NOK</p>
    </div>

    <button onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
  </div>
</div>

<script>
  // –ü–∞—Ä–æ–ª—å
  let CORRECT_PASSWORD = localStorage.getItem("password") || "4565";

  function checkPassword() {
    const pw = document.getElementById("password").value;
    if (pw === CORRECT_PASSWORD) {
      document.getElementById("login").style.display = "none";
      document.getElementById("app").style.display = "block";
      renderToday();
    } else {
      document.getElementById("error").style.display = "block";
    }
  }

  function showChangePw() {
    document.getElementById("login").style.display = "none";
    document.getElementById("changePwBox").style.display = "flex";
  }

  function backToLogin() {
    document.getElementById("changePwBox").style.display = "none";
    document.getElementById("login").style.display = "flex";
  }

  function changePassword() {
    const oldPw = document.getElementById("oldPw").value;
    const newPw = document.getElementById("newPw").value;
    const confirmPw = document.getElementById("confirmPw").value;

    if (oldPw === CORRECT_PASSWORD && newPw === confirmPw && newPw) {
      CORRECT_PASSWORD = newPw;
      localStorage.setItem("password", newPw);
      alert("–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω—ë–Ω!");
      backToLogin();
    } else {
      document.getElementById("pwError").style.display = "block";
    }
  }

  function logout() {
    document.getElementById("app").style.display = "none";
    document.getElementById("login").style.display = "flex";
  }

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤ 24—á
  function formatTime24(t) {
    if (!t) return "";
    const [h, m] = t.split(":");
    return ("0" + h).slice(-2) + ":" + ("0" + m).slice(-2);
  }

  // –ó–∞–ø–∏—Å–∏
  let bookings = JSON.parse(localStorage.getItem("bookings") || "[]");

  function addBooking() {
    const name = document.getElementById("name").value;
    const phone = document.getElementById("phone").value;
    const date = document.getElementById("date").value;
    const time = document.getElementById("time").value;
    const price = parseFloat(document.getElementById("price").value || 0);

    if (name && phone && date && time) {
      const formattedTime = formatTime24(time);
      const dateTime = date + "T" + formattedTime;
      bookings.push({ name, phone, date, time: formattedTime, dateTime, price });
      localStorage.setItem("bookings", JSON.stringify(bookings));
      renderBookings();
      renderToday();
    }
  }

  function renderBookings() {
    const search = document.getElementById("searchAll").value.toLowerCase();
    const table = document.getElementById("bookingTable");
    table.innerHTML = "<tr><th>–ò–º—è</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>–î–∞—Ç–∞</th><th>–í—Ä–µ–º—è</th><th>–¶–µ–Ω–∞</th></tr>";
    bookings
      .filter(b => b.name.toLowerCase().includes(search))
      .forEach(b => {
        table.innerHTML += `<tr><td>${b.name}</td><td>${b.phone}</td><td>${b.date}</td><td>${formatTime24(b.time)}</td><td>${b.price} NOK</td></tr>`;
      });
  }

  function renderToday() {
    const today = new Date().toISOString().split("T")[0];
    const search = document.getElementById("searchToday").value.toLowerCase();
    const table = document.getElementById("todayTable");
    table.innerHTML = "<tr><th>–ò–º—è</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>–í—Ä–µ–º—è</th><th>–î–µ–π—Å—Ç–≤–∏–µ</th></tr>";
    let todayRevenue = 0;

    bookings.forEach((b, i) => {
      if (b.date === today && b.name.toLowerCase().includes(search)) {
        todayRevenue += b.price;
        table.innerHTML += `<tr><td>${b.name}</td><td>${b.phone}</td><td>${formatTime24(b.time)}</td>
          <td><span class="delete-btn" onclick="deleteBooking(${i})">‚ùå</span></td></tr>`;
      }
    });

    document.getElementById("dailyRevenue").innerText = "–°–µ–≥–æ–¥–Ω—è: " + todayRevenue + " NOK";

    const month = new Date().toISOString().slice(0,7);
    const monthlyRevenue = bookings.filter(b=>b.date.startsWith(month)).reduce((sum,b)=>sum+b.price,0);
    document.getElementById("monthlyRevenue").innerText = "–≠—Ç–æ—Ç –º–µ—Å—è—Ü: " + monthlyRevenue + " NOK";
  }

  function deleteBooking(index) {
    bookings.splice(index,1);
    localStorage.setItem("bookings", JSON.stringify(bookings));
    renderBookings();
    renderToday();
  }

  // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ 15 –º–∏–Ω –¥–æ
  if ("Notification" in window) {
    Notification.requestPermission();
  }

  setInterval(() => {
    const now = new Date();
    bookings.forEach(b => {
      const appt = new Date(b.dateTime);
      const diff = (appt - now) / 60000;
      if (diff > 14 && diff < 15) {
        if (Notification.permission === "granted") {
          new Notification("üíÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: " + b.name + " –≤ " + formatTime24(b.time));
        }
      }
    });
  }, 60000);

  renderBookings();
</script>
</body>
</html>
