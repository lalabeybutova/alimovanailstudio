<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Alimova Nail Studio</title>
  <style>
    body {margin:0;font-family:'Segoe UI',sans-serif;background:#fffafc;color:#333;}
    header {background:linear-gradient(90deg,#fce7f3,#e0e7ff,#fef3c7);padding:20px;text-align:center;
      font-size:26px;font-weight:bold;color:#6b21a8;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
    .overlay{padding:20px;max-width:900px;margin:auto;}
    input,button{padding:10px;font-size:16px;border-radius:10px;border:1px solid #ccc;margin:5px;}
    button{background:linear-gradient(90deg,#ec4899,#8b5cf6);color:#fff;border:none;cursor:pointer;}
    button:hover{opacity:0.9;}
    .card{background:white;padding:15px;border-radius:16px;box-shadow:0 4px 15px rgba(0,0,0,0.1);margin-bottom:20px;}
    table{width:100%;border-collapse:collapse;}
    th,td{border:1px solid #ddd;padding:8px;text-align:center;}
    th{background:#fce7f3;}
    .action-btn{cursor:pointer;margin:0 5px;font-weight:bold;}
    .edit-btn{color:#2563eb;}
    .delete-btn{color:red;}
    .save-btn{color:green;}
    .cancel-btn{color:gray;}
    #loginCard{max-width:400px;margin:80px auto;}
  </style>
</head>
<body>
<div class="overlay" id="app" style="display:none;">
  <header>üíÖ Alimova Nail Studio</header>

  <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ -->
  <div class="card">
    <h2>‚ûï –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</h2>
    <input type="text" id="name" placeholder="–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞" />
    <input type="tel" id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" />
    <input type="date" id="date" />
    <input type="time" id="time" />
    <input type="number" id="price" placeholder="–¶–µ–Ω–∞ (NOK)" />
    <button onclick="addBooking()">–î–æ–±–∞–≤–∏—Ç—å</button>
  </div>

  <!-- –í—Å–µ –∑–∞–ø–∏—Å–∏ -->
  <div class="card">
    <h2>üìã –í—Å–µ –∑–∞–ø–∏—Å–∏</h2>
    <input type="text" id="searchAll" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏..." oninput="renderBookings()" />
    <table id="bookingTable">
      <tr><th>–ò–º—è</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>–î–∞—Ç–∞</th><th>–í—Ä–µ–º—è</th><th>–¶–µ–Ω–∞</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr>
    </table>
  </div>

  <!-- –î–æ—Ö–æ–¥ -->
  <div class="card">
    <h2>üìä –î–æ—Ö–æ–¥</h2>
    <p id="dailyRevenue">–°–µ–≥–æ–¥–Ω—è: 0 NOK</p>
    <p id="monthlyRevenue">–≠—Ç–æ—Ç –º–µ—Å—è—Ü: 0 NOK</p>
  </div>

  <button onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
</div>

<!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
<div id="loginCard" class="card">
  <h2>üîí –í—Ö–æ–¥</h2>
  <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å" />
  <button onclick="login()">–í–æ–π—Ç–∏</button>
  <p style="margin-top:10px;"><a href="#" onclick="showChangePassword()">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</a></p>
  <div id="changePasswordBox" style="display:none;margin-top:10px;">
    <input type="password" id="oldPass" placeholder="–°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å" />
    <input type="password" id="newPass" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" />
    <input type="password" id="confirmPass" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" />
    <button onclick="changePassword()">–°–º–µ–Ω–∏—Ç—å</button>
  </div>
</div>

<script>
let bookings = JSON.parse(localStorage.getItem("bookings") || "[]");
let password = localStorage.getItem("password") || "4565";

function formatTime24(t){
  if(!t) return "";
  const [h,m] = t.split(":");
  return ("0"+h).slice(-2)+":"+("0"+m).slice(-2);
}

// --- –õ–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª–∏ ---
function login(){
  const pass = document.getElementById("loginPassword").value;
  if(pass===password){
    document.getElementById("loginCard").style.display="none";
    document.getElementById("app").style.display="block";
    renderBookings();
    askNotificationPermission();
  } else { alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!"); }
}
function logout(){
  document.getElementById("app").style.display="none";
  document.getElementById("loginCard").style.display="block";
}
function showChangePassword(){
  document.getElementById("changePasswordBox").style.display="block";
}
function changePassword(){
  const oldP=document.getElementById("oldPass").value;
  const newP=document.getElementById("newPass").value;
  const confirmP=document.getElementById("confirmPass").value;
  if(oldP!==password){alert("–°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–Ω—ã–π");return;}
  if(newP!==confirmP){alert("–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç");return;}
  password=newP;localStorage.setItem("password",password);
  alert("–ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω—ë–Ω!");
  document.getElementById("changePasswordBox").style.display="none";
}

// --- –ó–∞–ø–∏—Å–∏ ---
function addBooking(){
  const name=document.getElementById("name").value;
  const phone=document.getElementById("phone").value;
  const date=document.getElementById("date").value;
  const time=document.getElementById("time").value;
  const price=parseFloat(document.getElementById("price").value)||0;
  if(!name||!phone||!date||!time){alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è");return;}
  bookings.push({name,phone,date,time:formatTime24(time),dateTime:date+"T"+time,price});
  localStorage.setItem("bookings",JSON.stringify(bookings));
  renderBookings();
  document.getElementById("name").value=document.getElementById("phone").value=
  document.getElementById("date").value=document.getElementById("time").value=
  document.getElementById("price").value="";
}

function renderBookings(){
  const search=document.getElementById("searchAll").value?.toLowerCase()||"";
  const table=document.getElementById("bookingTable");
  table.innerHTML="<tr><th>–ò–º—è</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>–î–∞—Ç–∞</th><th>–í—Ä–µ–º—è</th><th>–¶–µ–Ω–∞</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr>";
  bookings.filter(b=>b.name.toLowerCase().includes(search))
    .forEach((b,i)=>{
      table.innerHTML+=`
      <tr id="row-${i}">
        <td>${b.name}</td><td>${b.phone}</td><td>${b.date}</td>
        <td>${formatTime24(b.time)}</td><td>${b.price} NOK</td>
        <td>
          <span class="action-btn edit-btn" onclick="editBooking(${i})">‚úèÔ∏è</span>
          <span class="action-btn delete-btn" onclick="deleteBooking(${i})">‚ùå</span>
        </td>
      </tr>`;
    });
  updateRevenue();
}

function editBooking(i){
  const b=bookings[i];
  const row=document.getElementById("row-"+i);
  row.innerHTML=`
    <td contenteditable="true">${b.name}</td>
    <td contenteditable="true">${b.phone}</td>
    <td contenteditable="true">${b.date}</td>
    <td contenteditable="true">${formatTime24(b.time)}</td>
    <td contenteditable="true">${b.price}</td>
    <td>
      <span class="action-btn save-btn" onclick="saveEdit(${i})">üíæ</span>
      <span class="action-btn cancel-btn" onclick="renderBookings()">‚ùå</span>
    </td>`;
}
function saveEdit(i){
  const cells=document.getElementById("row-"+i).children;
  const name=cells[0].innerText;
  const phone=cells[1].innerText;
  const date=cells[2].innerText;
  const time=cells[3].innerText;
  const price=parseFloat(cells[4].innerText)||0;
  bookings[i]={name,phone,date,time:formatTime24(time),dateTime:date+"T"+time,price};
  localStorage.setItem("bookings",JSON.stringify(bookings));
  renderBookings();
}
function deleteBooking(i){
  if(confirm("–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?")){
    bookings.splice(i,1);
    localStorage.setItem("bookings",JSON.stringify(bookings));
    renderBookings();
  }
}

// --- –î–æ—Ö–æ–¥ ---
function updateRevenue(){
  const today=new Date().toISOString().split("T")[0];
  const month=new Date().toISOString().slice(0,7);
  let todayRev=0,monthRev=0;
  bookings.forEach(b=>{
    if(b.date===today) todayRev+=b.price;
    if(b.date.startsWith(month)) monthRev+=b.price;
  });
  document.getElementById("dailyRevenue").innerText="–°–µ–≥–æ–¥–Ω—è: "+todayRev+" NOK";
  document.getElementById("monthlyRevenue").innerText="–≠—Ç–æ—Ç –º–µ—Å—è—Ü: "+monthRev+" NOK";
}

// --- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ---
function askNotificationPermission(){
  if(Notification.permission!=="granted"){Notification.requestPermission();}
  setInterval(checkReminders,60000);
}
function checkReminders(){
  const now=new Date();
  bookings.forEach(b=>{
    const bookingTime=new Date(b.dateTime);
    const diff=(bookingTime-now)/60000;
    if(diff>14&&diff<16){
      new Notification("üíÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: "+b.name+" –≤ "+formatTime24(b.time));
    }
  });
}
</script>
</body>
</html>
